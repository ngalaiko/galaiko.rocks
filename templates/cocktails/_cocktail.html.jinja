{% extends "_layout.html.jinja" %}

{% block title %}{{ cocktail.metadata.map.title }}{% endblock %}

{% macro float(value) -%}
    {{ "%.15g" | format(value) }}
{%- endmacro %}

{%- macro quantity_value(value) -%}
    {%- if value.type == 'fraction' -%}
        {{ float(value.value.num) }}/{{ float(value.value.den) }}
    {%- elif value.type == 'regular' -%}
        {{ float(value.value) }}
    {%- endif -%}
{%- endmacro -%}

{%- macro quantity(quantity) -%}
    {{ quantity_value(quantity.value.value) }} {% if quantity.unit %}{{ quantity.unit }}{% endif %}
{%- endmacro -%}

{% block content %}
    <aside>
        <img
            width="800"
            loading="lazy"
            src="{{ cocktail.metadata.map.title | slugify }}.jpeg.800x0@2x.webp"
            alt="Picture of {{ cocktail.metadata.map.title }} cocktail"
        />
    </aside>

    <section>
        <h2>ingredients</h2>
        <ul>
            {%- for ingredient in cocktail.ingredients %}
                <li><b>{{ ingredient.name }}</b>
                    {%- if ingredient.quantity -%}
                    :
                    {{ quantity(ingredient.quantity) }}
                    {% endif %}
                </li>
            {%- endfor -%}
        </ul>
    </section>

    <section>
        <h2>cookware</h2>
        <ul>
            {%- for cookware in cocktail.cookware %}
                <li>{{ cookware.name }}</li>
            {%- endfor -%}
        </ul>
    </section>

    <hr />

    <section>
        <ol>
            {%- for section in cocktail.sections -%}
                {%- for step in section.steps -%}
                    <li>
                        {%- for item in step['items'] -%}
                            {%- if item.type == 'text' -%}
                                {{ item.value }}
                            {%- elif item.type == 'timer' -%}
                                {{ quantity(cocktail.timers[item.index].quantity) }}
                            {%- elif item.type == 'ingredient' -%}
                                {{ cocktail.ingredients[item.index].name }}
                            {%- elif item.type == 'cookware' -%}
                                {{ cocktail.cookware[item.index].name }}
                            {%- endif -%}
                        {%- endfor -%}
                    </li>
                {%- endfor %}
            {%- endfor %}
        </ol>
    </section>


    {%- if cocktail.metadata.source %}
        <hr />

        <section>
            source:
            {%- if cocktail.metadata.source.name and cocktail.metadata.source.url  %}
                <a href="{{ cocktail.metadata.source.url }}">{{ cocktail.metadata.source.name }}</a>
            {%- elif cocktail.metadata.source.url  %}
                {%- set url = cocktail.metadata.source.url | urlparse %}
                <a href="{{ cocktail.metadata.source.url }}">{{ url.netloc }}</a>
            {%- elif cocktail.metadata.source.name  %}
                {{ cocktail.metadata.source.name }}
            {%- endif %}
        </section>
    {%- endif %}
{% endblock %}
